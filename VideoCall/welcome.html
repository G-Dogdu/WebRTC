<!DOCTYPE html>
<html lang = "en">

<head>
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/socket-io.js"></script>
    <script src="js/current-cam.js"></script>
    <meta charset = "utf-8" /> 
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
<script>

var userName = "";
var userToCall = "";

var urlParams = new URLSearchParams(location.search);

if(urlParams.has('username')) {
    userName = String(urlParams.get('username'));
}
        
    const socket = io('https://webrtc-signalserver.azurewebsites.net');
 //const socket = io('http://localhost:3002');
    

    $(document).ready(function(){
      
         
        $("#callButton").on("click",function(){
            userToCall = document.getElementById("nameInput").value;
            if(userToCall.length>0){
                document.getElementById("greet").innerHTML = "Calling " + userToCall;
                socket.emit("offer",userToCall);     
            }
            else{
                alert("Username of the user you want to call is required.");
            }
        });


        socket.on("offer", function () {
            //when somebody wants to call us 

        });


        socket.on("connect", function () {
            console.log("sunucuya baglandim");   
            document.getElementById("greet").innerHTML = "Hosgeldin " + userName;   //IF USERNAME DOESN'T EXIST         

        });

        socket.on("welcome", function(){
            if(userName.length>0){
                socket.emit("login",userName);
            }
                   
        });
        
        console.log("document is ready");
    });

    
</script>

<div id="welcome">
    <h1 id="greet"></h1>
</div>

<div id="camera">
    <video autoplay></video>  
</div>
    <section id="welcomeCall">
        <div class="welcome-form">
            <form>
                <div class="welcome-group">
                    <label for="callName" id="callNameLabel">Enter Name:</label>
                    <input type="name" name="nameInput" id="nameInput">
                    <button type="submit" class="buttonCall" id="callButton">Call</button>
                </div>

            </form>
        </div>
    </section>
</body>
</html>